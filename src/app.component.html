
<main class="min-h-screen text-slate-200 p-4 sm:p-8">
  <div class="max-w-4xl mx-auto">
    <!-- Header and Search -->
    <header class="text-center mb-8">
      <h1 class="text-4xl sm:text-5xl font-bold bg-gradient-to-r from-sky-400 to-blue-500 text-transparent bg-clip-text mb-4">
        GitHub Profile Finder AI
      </h1>
      <p class="text-slate-400 text-lg">
        Discover GitHub profiles and get an AI-powered summary.
      </p>
    </header>

    <form (ngSubmit)="searchUser()" class="flex gap-2 mb-8 max-w-lg mx-auto">
      <input
        type="text"
        [(ngModel)]="username"
        name="username"
        placeholder="Enter GitHub username..."
        class="w-full bg-slate-800 border border-slate-700 rounded-lg px-4 py-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-sky-500 focus:outline-none transition"
      />
      <button
        type="submit"
        [disabled]="loading()"
        class="bg-sky-600 hover:bg-sky-500 disabled:bg-slate-700 disabled:cursor-not-allowed text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center"
      >
        @if (loading()) {
          <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        } @else {
          <span>Search</span>
        }
      </button>
    </form>

    <!-- Content Area -->
    <div class="min-h-[500px]">
      @if (loading() && !userData()) {
        <div class="flex justify-center items-center h-64">
          <svg class="animate-spin h-10 w-10 text-sky-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
        </div>
      }
      
      @if (error()) {
        <div class="bg-red-900/50 border border-red-700 text-red-300 px-4 py-3 rounded-lg text-center" role="alert">
          <strong class="font-bold">Oops! </strong>
          <span class="block sm:inline">{{ error() }}</span>
        </div>
      }

      @if (userData(); as user) {
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <!-- Left Column: Profile Card -->
          <aside class="md:col-span-1 bg-slate-800/50 border border-slate-700 p-6 rounded-2xl shadow-lg h-fit">
            <img [src]="user.avatar_url" alt="Profile avatar" class="rounded-full w-32 h-32 mx-auto mb-4 border-4 border-slate-600 shadow-md">
            <h2 class="text-2xl font-bold text-white text-center">{{ user.name }}</h2>
            <a [href]="user.html_url" target="_blank" class="block text-lg text-sky-400 text-center hover:underline mb-4">@{{ user.login }}</a>
            <p class="text-slate-400 mb-6 text-center">{{ user.bio }}</p>

            <div class="flex justify-center gap-6 mb-6">
              <div class="text-center">
                <span class="block text-2xl font-bold text-white">{{ user.public_repos }}</span>
                <span class="text-slate-400">Repos</span>
              </div>
              <div class="text-center">
                <span class="block text-2xl font-bold text-white">{{ user.followers }}</span>
                <span class="text-slate-400">Followers</span>
              </div>
              <div class="text-center">
                <span class="block text-2xl font-bold text-white">{{ user.following }}</span>
                <span class="text-slate-400">Following</span>
              </div>
            </div>

            <ul class="space-y-3 text-slate-300">
              @if (user.location) {
                <li class="flex items-center gap-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z" clip-rule="evenodd" /></svg>
                  <span>{{ user.location }}</span>
                </li>
              }
              @if (user.blog) {
                <li class="flex items-center gap-3">
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" viewBox="0 0 20 20" fill="currentColor"><path d="M11 3a1 1 0 100 2h2.586l-6.293 6.293a1 1 0 101.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z" /><path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z" /></svg>
                  <a [href]="user.blog" target="_blank" class="hover:underline truncate">{{ user.blog }}</a>
                </li>
              }
              <li class="flex items-center gap-3">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-slate-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd" /></svg>
                <span>Joined {{ formatDate(user.created_at) }}</span>
              </li>
            </ul>
          </aside>

          <!-- Right Column: Repos -->
          <div class="md:col-span-2">
            <!-- AI Summary Section -->
            <div class="bg-slate-800/50 border border-slate-700 p-6 rounded-2xl shadow-lg mb-8">
                <h3 class="text-2xl font-bold text-white mb-4">AI-Powered Summary</h3>
                @if (!geminiSummary() && !geminiLoading()) {
                  <p class="text-slate-400 mb-4">Click the button to generate a professional summary of this developer's profile using Gemini.</p>
                  <button (click)="generateSummary()" class="bg-gradient-to-r from-purple-500 to-indigo-600 hover:opacity-90 text-white font-semibold py-2 px-4 rounded-lg transition duration-300 w-full">
                    Generate with Gemini
                  </button>
                }

                @if (geminiLoading()) {
                  <div class="flex items-center gap-3 text-slate-400">
                    <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                      <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>Generating summary... This may take a moment.</span>
                  </div>
                }

                @if (geminiSummary()) {
                  <p class="text-slate-300 whitespace-pre-wrap">{{ geminiSummary() }}</p>
                }
            </div>

            <h3 class="text-2xl font-bold text-white mb-4">Recent Repositories</h3>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
              @for (repo of userRepos(); track repo.id) {
                <a [href]="repo.html_url" target="_blank" class="block bg-slate-800/50 border border-slate-700 p-4 rounded-xl hover:border-sky-500 transition duration-300">
                  <h4 class="font-bold text-sky-400 truncate">{{ repo.name }}</h4>
                  <p class="text-slate-400 text-sm h-10 overflow-hidden">{{ repo.description || 'No description provided.' }}</p>
                  <div class="flex justify-between items-center mt-3 text-sm text-slate-500">
                    <div class="flex items-center gap-1">
                      <div class="h-3 w-3 rounded-full" [class]="repo.language ? 'bg-sky-400' : 'bg-slate-600'"></div>
                      <span>{{ repo.language || 'N/A' }}</span>
                    </div>
                    <div class="flex items-center gap-4">
                      <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>
                        {{ repo.stargazers_count }}
                      </span>
                      <span class="flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0l-1.5-1.5a2 2 0 112.828-2.828l1.5 1.5l3-3zm-2.828 8.414a2 2 0 012.828 0l3-3a2 2 0 01-2.828-2.828l-1.5 1.5-3 3zm-2.828-2.828a2 2 0 010 2.828l-3 3a2 2 0 11-2.828-2.828l1.5-1.5 3-3z" clip-rule="evenodd" /></svg>
                        {{ repo.forks_count }}
                      </span>
                    </div>
                  </div>
                </a>
              }
              @if (userRepos().length === 0) {
                <p class="text-slate-400 col-span-1 lg:col-span-2">No public repositories found.</p>
              }
            </div>
          </div>
        </div>
      }
    </div>
  </div>
</main>
